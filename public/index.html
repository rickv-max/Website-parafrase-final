<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Alat Parafrase AI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jsdiff/5.1.0/diff.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-X2TL6DZQM0"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-X2TL6DZQM0');
</script>
    <style>
        body{font-family:'Inter',sans-serif;background-color:#0f172a}.glassmorphism{background:rgba(255,255,255,0.1);backdrop-filter:blur(10px);-webkit-backdrop-filter:blur(10px);border:1px solid rgba(255,255,255,0.2)}textarea::placeholder{color:#94a3b8}.custom-scrollbar::-webkit-scrollbar{width:8px}.custom-scrollbar::-webkit-scrollbar-track{background:transparent}.custom-scrollbar::-webkit-scrollbar-thumb{background-color:#475569;border-radius:10px;border:2px solid transparent;background-clip:content-box}@keyframes spin{to{transform:rotate(360deg)}}.loader{animation:spin 1s linear infinite}.highlight{background-color:rgba(99,102,241,0.3);color:#c7d2fe;border-radius:4px;padding:2px 1px;font-weight:500}
        .highlight-risk{background-color: rgba(251, 191, 36, 0.3); color: #fef3c7; border-radius: 4px; padding: 2px 1px; font-weight: 500;}
   .suggestion-badge { 
    position: absolute; 
    top: -0.5rem; 
    right: -0.5rem; 
    font-size: 0.65rem; 
    font-weight: 600; 
    color: #10b981; 
    background-color: rgba(16, 185, 129, 0.1); 
    padding: 2px 6px; 
    border-radius: 9999px; 
    border: 1px solid rgba(16, 185, 129, 0.3); 
    pointer-events: none; 
    transform: rotate(15deg); 
}

    </style>
</head>
<body class="text-white antialiased">
<div class="min-h-screen flex flex-col items-center justify-center p-4">
    <header class="text-center mb-8 w-full max-w-6xl"><h1 class="text-4xl sm:text-5xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-indigo-400 to-cyan-400">Parafrase Gratis</h1><p class="text-slate-400 mt-4 text-lg max-w-2xl mx-auto">Formulasikan ulang tulisan Anda menjadi karya yang sepenuhnya baru, akurat, dan bebas plagiarisme.</p></header>
    <main class="w-full max-w-6xl flex flex-col lg:flex-row items-start gap-6">
        <div class="w-full lg:w-1/2 flex flex-col gap-4">
            <div class="glassmorphism rounded-xl p-3"><div id="mode-container" class="grid grid-cols-2 sm:grid-cols-3 gap-2"><button class="mode-button relative" data-mode="standard">
    Standard
    <span class="suggestion-badge">Saran</span>
</button>
<button class="mode-button" data-mode="formal">Formal</button><button class="mode-button" data-mode="creative">Kreatif</button><button class="mode-button" data-mode="simple">Sederhana</button><button class="mode-button col-span-2 sm:col-span-1 relative" data-mode="mahasiswa">
    Mahasiswa
    <span class="suggestion-badge">Saran</span>
</button>
</div></div>
            <div class="glassmorphism rounded-xl p-6 h-full flex-grow flex flex-col">
                <div class="flex justify-between items-center mb-4"><h2 class="text-xl font-semibold text-slate-200">Teks Asli</h2><button id="clear-button" title="Bersihkan Teks" class="text-slate-400 hover:text-white transition-colors"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg></button></div>
                <textarea id="original-text" class="custom-scrollbar w-full h-64 md:h-80 flex-grow bg-slate-800/50 p-4 rounded-lg text-slate-300 placeholder-slate-500 focus:ring-2 focus:ring-indigo-500 focus:outline-none transition resize-none" placeholder="Masukkan atau tempel teks Anda di sini..."></textarea>
            </div>
        </div>
        <div class="w-full lg:w-auto flex items-center justify-center py-4 lg:py-0 lg:self-center">
            <button id="paraphrase-button" class="w-full lg:w-auto bg-gradient-to-r from-indigo-500 to-cyan-500 hover:from-indigo-600 hover:to-cyan-600 text-white font-bold py-3 px-6 rounded-full shadow-lg hover:shadow-cyan-500/50 transform hover:scale-105 transition-all duration-300 flex items-center justify-center gap-3"><span id="button-text">Parafrase</span><div id="loader" class="hidden loader w-5 h-5 border-2 border-white border-t-transparent rounded-full"></div></button>
        </div>
        <div class="w-full lg:w-1/2 flex flex-col gap-4">
            <div class="glassmorphism rounded-xl p-6 h-full flex flex-col flex-grow">
                <div class="flex justify-between items-center mb-4"><h2 class="text-xl font-semibold text-slate-200">Hasil Parafrase</h2><button id="copy-button" title="Salin Hasil" class="text-slate-400 hover:text-white transition-colors flex items-center gap-2"><span id="copy-text">Salin</span><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg></button></div>
                <div id="paraphrased-text" class="custom-scrollbar w-full flex-grow bg-slate-800/50 p-4 rounded-lg text-slate-300 overflow-y-auto leading-relaxed"><span class="text-slate-500">Hasil parafrase akan muncul di sini...</span></div>
            </div>
            <div id="authenticity-container" class="hidden glassmorphism rounded-xl p-4 flex flex-col gap-3">
                <button id="check-authenticity-button" class="w-full bg-amber-500 hover:bg-amber-600 text-slate-900 font-bold py-2 px-4 rounded-lg transition-colors flex items-center justify-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20.38 3.46 16 2a4 4 0 0 0-8 0L3.62 3.46a2 2 0 0 0-1.34 2.23l.58 3.47a1 1 0 0 0 .99.84H6v10c0 1.1.9 2 2 2h8a2 2 0 0 0 2-2V10h2.15a1 1 0 0 0 .99-.84l.58-3.47a2 2 0 0 0-1.34-2.23z"></path></svg>
                    <span>Cek Keaslian</span>
                </button>
                <div id="authenticity-result" class="text-sm text-slate-300 p-3 bg-slate-800/50 rounded-lg hidden"></div>
            </div>
        </div>
    </main>
</div>
<script>
    // --- Element References ---
    const originalTextInput = document.getElementById('original-text');
    const paraphrasedTextOutput = document.getElementById('paraphrased-text');
    const paraphraseButton = document.getElementById('paraphrase-button');
    const copyButton = document.getElementById('copy-button');
    const clearButton = document.getElementById('clear-button');
    const loader = document.getElementById('loader');
    const buttonText = document.getElementById('button-text');
    const copyText = document.getElementById('copy-text');
    const modeButtons = document.querySelectorAll('.mode-button');
    const authenticityContainer = document.getElementById('authenticity-container');
    const checkButton = document.getElementById('check-authenticity-button');
    const resultDiv = document.getElementById('authenticity-result');

    // --- Config & State ---
    const activeModeClass = 'bg-indigo-600 text-white font-semibold';
    const inactiveModeClass = 'bg-slate-700 hover:bg-slate-600 text-slate-300';
    let currentMode = 'standard';
    const prompts = {
        standard: "Anda adalah ahli parafrase...", // (and so on, prompts are the same)
        formal: "Anda adalah seorang penulis akademis...",
        creative: "Anda adalah seorang penulis kreatif...",
        simple: "Anda adalah seorang ahli penyederhanaan konten...",
        mahasiswa: "Anda adalah seorang mahasiswa yang sedang mengerjakan tugas..."
    };

    // --- Functions ---
    async function handleParaphrase() {
    const userInput = originalTextInput.value.trim();
    if (!userInput) {
        paraphrasedTextOutput.innerHTML = '<span class="text-yellow-400">Silakan masukkan teks terlebih dahulu.</span>';
        return;
    }
    setLoading(true);
    paraphrasedTextOutput.innerHTML = '<span class="text-slate-500">Sedang memproses...</span>';
    authenticityContainer.classList.add('hidden');

    try {
        const response = await fetch("/api/paraphrase", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            // Ini adalah body yang benar, mengirim mode dan text secara terpisah
            body: JSON.stringify({ mode: currentMode, text: userInput })
        });

        if (!response.ok) {
            const errorData = await response.json();
            throw new Error(errorData.error?.message || `API Error: ${response.status}`);
        }

        const result = await response.json();
        const generatedText = result.candidates?.[0]?.content?.parts?.[0]?.text;

        if (generatedText) {
            const cleanedText = cleanAiResponse(generatedText);
            displayHighlightedDiff(originalTextInput.value.trim(), cleanedText);
            authenticityContainer.classList.remove('hidden');
        } else {
            throw new Error("Tidak ada konten yang dihasilkan oleh AI.");
        }
    } catch (error) {
        console.error("Error during paraphrasing:", error);
        paraphrasedTextOutput.innerHTML = `<span class="text-red-400">Maaf, terjadi kesalahan. Detail: ${error.message}</span>`;
    } finally {
        setLoading(false);
    }
}

        setLoading(true);
        paraphrasedTextOutput.innerHTML = '<span class="text-slate-500">Sedang memproses...</span>';
        authenticityContainer.classList.add('hidden');

        const fullPrompt = `${prompts[currentMode]}\n\nTeks asli:\n---\n${userInput}`;

        try {
            const response = await fetch("/api/paraphrase", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ mode: currentMode, text: userInput })

            });

            if (!response.ok) {
                const errorData = await response.json();
                throw new Error(errorData.error?.message || `API Error: ${response.status}`);
            }

            const result = await response.json();
            const generatedText = result.candidates?.[0]?.content?.parts?.[0]?.text;

            if (generatedText) {
                const cleanedText = cleanAIOutput(generatedText);
                displayHighlightedDiff(originalTextInput.value.trim(), cleanedText);
                authenticityContainer.classList.remove('hidden');
            } else {
                throw new Error("Tidak ada konten yang dihasilkan oleh AI.");
            }
        } catch (error) {
            console.error("Error during paraphrasing:", error);
            paraphrasedTextOutput.innerHTML = `<span class="text-red-400">Maaf, terjadi kesalahan. Detail: ${error.message}</span>`;
        } finally {
            setLoading(false);
        }
    }

    function cleanAIOutput(text) {
        let cleaned = text.trim();
        const lines = cleaned.split('\n');
        if (lines.length > 1 && lines[0].includes(':') && lines[0].length < 150) {
            cleaned = lines.slice(1).join('\n').trim();
        }
        cleaned = cleaned.replace(/\*/g, '');
        return cleaned;
    }

    function displayHighlightedDiff(original, modified) {
        const diff = Diff.diffWords(original, modified, { ignoreCase: false });
        const fragment = document.createDocumentFragment();
        diff.forEach(part => {
            let node;
            if (part.added) {
                node = document.createElement('span');
                node.className = 'highlight';
                node.textContent = part.value;
            } else if (!part.removed) {
                node = document.createTextNode(part.value);
            }
            if (node) fragment.appendChild(node);
        });
        paraphrasedTextOutput.innerHTML = '';
        paraphrasedTextOutput.appendChild(fragment);
    }

    async function handleAuthenticityCheck() {
        const paraphrasedText = paraphrasedTextOutput.innerText;
        if (!paraphrasedText) return;
        resultDiv.classList.remove('hidden');
        resultDiv.innerHTML = '<span class="text-slate-400">Menganalisis keaslian teks...</span>';
        checkButton.disabled = true;
        try {
            const response = await fetch('/api/check-authenticity', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ text: paraphrasedText })
            });
            if (!response.ok) throw new Error('Gagal menghubungi server analisis.');
            const result = await response.json();
            resultDiv.innerHTML = result.summary || 'Analisis selesai.';
            if (result.risky_sentences && result.risky_sentences.length > 0) {
                let currentHtml = paraphrasedTextOutput.innerHTML;
                result.risky_sentences.forEach(sentence => {
                    const cleanSentence = sentence.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
                    const regex = new RegExp(cleanSentence, "gi");
                    currentHtml = currentHtml.replace(regex, `<span class="highlight-risk">${sentence}</span>`);
                });
                paraphrasedTextOutput.innerHTML = currentHtml;
            }
        } catch (error) {
            resultDiv.innerHTML = `<span class="text-red-400">Error: ${error.message}</span>`;
        } finally {
            checkButton.disabled = false;
        }
    }

    function handleCopy() {
        const textToCopy = paraphrasedTextOutput.innerText;
        if (textToCopy && !paraphrasedTextOutput.querySelector('span.text-slate-500')) {
            const tempTextArea = document.createElement('textarea');
            tempTextArea.value = textToCopy;
            document.body.appendChild(tempTextArea);
            tempTextArea.select();
            document.execCommand('copy');
            document.body.removeChild(tempTextArea);
            copyText.innerText = 'Tersalin!';
            setTimeout(() => { copyText.innerText = 'Salin'; }, 2000);
        }
    }

    function setLoading(isLoading) {
        paraphraseButton.disabled = isLoading;
        loader.classList.toggle('hidden', !isLoading);
        buttonText.classList.toggle('hidden', isLoading);
    }

    function updateActiveButton(activeButton) {
        modeButtons.forEach(button => {
            button.classList.remove(...activeModeClass.split(' '));
            button.classList.add(...inactiveModeClass.split(' '));
        });
        activeButton.classList.remove(...inactiveModeClass.split(' '));
        activeButton.classList.add(...activeModeClass.split(' '));
    }

    function init() {
        paraphraseButton.addEventListener('click', handleParaphrase);
        copyButton.addEventListener('click', handleCopy);
        clearButton.addEventListener('click', () => originalTextInput.value = '');
        checkButton.addEventListener('click', handleAuthenticityCheck);
        modeButtons.forEach(button => {
            button.addEventListener('click', () => {
                currentMode = button.dataset.mode;
                updateActiveButton(button);
            });
        });
        updateActiveButton(document.querySelector('.mode-button[data-mode="standard"]'));
    }

    init();
</script>
</body>
</html>
